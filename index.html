<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PORTAL GOV</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Roboto,sans-serif;background:linear-gradient(180deg,#0a7a3d,#f4c430);display:flex;justify-content:center;color:#111}
.app{width:100%;max-width:430px;padding:14px;border:4px solid #0a7a3d;border-radius:22px}
.card{background:#fff;border-radius:22px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.4)}
h1,h2,h3{text-align:center;margin:6px 0;color:#0a7a3d}
button,input{width:100%;padding:12px;margin:6px 0;border-radius:12px;border:1px solid #ccc;font-size:14px}
button{background:linear-gradient(135deg,#0a7a3d,#f4c430);color:#fff;font-weight:700;cursor:pointer}
.red{background:#e74c3c}
.gray{background:#ddd;color:#222}
.box{background:#f7fdf9;border-radius:14px;padding:12px;margin:10px 0}
.hidden{display:none}
.valor{font-size:22px;font-weight:700;color:#e60000;animation:piscar 1s infinite}
.dado{color:#e60000;animation:piscar 1.2s infinite}
@keyframes piscar{0%{opacity:1}50%{opacity:.3}100%{opacity:1}}
</style>
</head>

<body>
<div class="app">
<div class="card">

<div id="home">
<h1>PORTAL TRANSPARENTE</h1>
<button id="btnAcessar">ğŸ” Acessar</button>
</div>

<div id="login" class="hidden">
<h2>Login Governamental</h2>
<input id="luser" placeholder="Login">
<input id="lpass" type="password" placeholder="Senha">
<button id="btnEntrar">Entrar</button>
<button class="gray" id="btnVoltar">Voltar</button>
<p id="msg"></p>
</div>

<div id="painel" class="hidden">
<h2 id="titulo"></h2>

<div class="box">
Saldo disponÃ­vel:<br>
<span id="saldo" class="valor"></span><br>
Bloqueado: R$ <span id="bloq"></span>
</div>

<div class="box">
<h3>ğŸ“ˆ INDICADORES</h3>
<div id="indicadores"></div>
<button id="btnEditIndicadores" class="hidden">âœï¸ Editar Indicadores</button>
<button id="btnCriarIndicador" class="hidden">â• Criar Novo Indicador</button>
</div>

<div class="box hidden" id="boxAdmin">
<h3>ğŸ‘‘ AdministraÃ§Ã£o</h3>
<button id="btnCriarConta">â• Criar Conta</button>
<button id="btnApagarConta">ğŸ—‘ Apagar Conta</button>
<button id="btnVerContas">ğŸ‘ Ver Contas</button>
<div id="listaContas"></div>
</div>

<button id="btnNBDados">ğŸ” NB DADOS</button>
<button class="red" id="btnSair">ğŸšª Sair</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBvlLq0n9IGtR1zQepTYD6ceNpgta01feg",
  authDomain: "nb-brasil.firebaseapp.com",
  projectId: "nb-brasil",
  storageBucket: "nb-brasil.firebasestorage.app",
  messagingSenderId: "984879697926",
  appId: "1:984879697926:web:52874c6e95a78957ab7387",
  measurementId: "G-8H9D0WLQ79"
};

export const app = initializeApp(firebaseConfig);
export const analytics = getAnalytics(app);
export const db = getFirestore(app);
export const auth = getAuth(app);

/* ================= CONFIG ================= */
const FUNDADOR_LOGIN="FUNDADOR";
const FUNDADOR_SENHA="2007";

/* ================= INDICADORES PADRÃƒO ================= */

/* ================= UTIL ================= */
function formatar(v){return Number(v).toLocaleString('pt-BR',{minimumFractionDigits:2})}
function tela(id){["home","login","painel"].forEach(x=>docexport const INDICADORES_PADRAO = {
  "Agro PIB": "",
  "ArrecadaÃ§Ã£o Municipal Total": "",
  "ArrecadaÃ§Ã£o em Royalties": "",
  "Blindados e veÃ­culos de seguranÃ§a": "",
  "ClassificaÃ§Ã£o EcolÃ³gica": "",
  "Cobertura de Planos de saÃºde": "",
  "Cobertura de saÃºde pÃºblica": "",
  "Consultas anuais por habitante": "",
  "Crescimento do PIB municipal": "",
  "Crimes Violentos": "",
  "Custo de vida": "",
  "Delegacias e bases operacionais": "",
  "Desemprego": "",
  "Desmatamento (kmÂ²)": "",
  "Disponibilidade de leitos": "",
  "DÃ©ficit Fiscal": "",
  "DÃ©ficit Habitacional": "",
  "DÃ­vida Municipal": "",
  "DÃ­vida por habitante": "",
  "Efetivo de seguranÃ§a pÃºblica": "",
  "EmissÃ£o de COÂ² per capita": "",
  "Empregos no setor industrial": "",
  "Energia cobertura": "",
  "ExtensÃ£o viÃ¡ria pavimentada": "",
  "Eventos culturais (anuais)": "",
  "Expectativa de vida": "",
  "ExportaÃ§Ãµes municipais": "",
  "Ferrovias urbanas (metrÃ´/VLT)": "",
  "Ãreas verdes urbanas": "",
  "Gasto cultura/turismo": "",
  "Gastos PÃºblicos Totais": "",
  "Habitantes crianÃ§as/adolescentes": "",
  "Habitantes homens": "",
  "Habitantes mulheres": "",
  "HomicÃ­dios": "",
  "IPTU arrecadado": "",
  "ISS arrecadado": "",
  "ITBI arrecadado": "",
  "IncÃªndios urbanos/ambientais": "",
  "InflaÃ§Ã£o municipal estimada": "",
  "Internet da populaÃ§Ã£o": "",
  "Investimento PÃºblico Municipal": "",
  "Investimento em inovaÃ§Ã£o e tecnologia": "",
  "Investimento em educaÃ§Ã£o": "",
  "Investimento em saÃºde": "",
  "Leitos por habitantes": "",
  "LotaÃ§Ã£o hospitalar": "",
  "Moradia adequada": "",
  "Mortalidade infantil": "",
  "Mortalidade por doenÃ§as": "",
  "NÂº escolas privadas": "",
  "NÂº escolas pÃºblicas": "",
  "NÂº faculdades": "",
  "NÂº hospitais privados": "",
  "NÂº hospitais pÃºblicos": "",
  "NÂº universidades": "",
  "PIB municipal total": "",
  "PIB per capita": "",
  "PopulaÃ§Ã£o rural": "",
  "PopulaÃ§Ã£o urbana": "",
  "PopulaÃ§Ã£o em situaÃ§Ã£o de rua": "",
  "PopulaÃ§Ã£o total": "",
  "Portos e aeroportos": "",
  "PosiÃ§Ã£o econÃ´mica nacional": "",
  "ProduÃ§Ã£o industrial": "",
  "ProduÃ§Ã£o agropecuÃ¡ria": "",
  "Professores por aluno": "",
  "Qualidade das vias urbanas": "",
  "Qualidade das unidades de saÃºde": "",
  "Qualidade hospitalar": "",
  "Qualidade do ar": "",
  "Receitas tributÃ¡rias prÃ³prias": "",
  "Renda mÃ©dia municipal": "",
  "ResÃ­duos reciclados": "",
  "SalÃ¡rio mÃ©dio por setor": "",
  "SalÃ¡rio mÃ­nimo municipal": "",
  "Saneamento bÃ¡sico": "",
  "SensaÃ§Ã£o de seguranÃ§a": "",
  "Startups": "",
  "SuperlotaÃ§Ã£o do sistema prisional municipal": "",
  "Resultado orÃ§amentÃ¡rio": "",
  "Taxa de abandono escolar": "",
  "Taxa de alfabetizaÃ§Ã£o": "",
  "Taxa de analfabetismo": "",
  "Taxa de crescimento populacional": "",
  "Taxa de escolaridade fundamental": "",
  "Taxa de escolaridade mÃ©dia": "",
  "Taxa de escolaridade superior": "",
  "Taxa de locaÃ§Ã£o residencial": "",
  "Taxa de migraÃ§Ã£o": "",
  "Taxa de pobreza": "",
  "Taxa de propriedade residencial": "",
  "Taxa de qualificaÃ§Ã£o profissional": "",
  "Trabalho feminino": "",
  "Trabalho juvenil": "",
  "Trabalho informal": "",
  "Transporte pÃºblico": "",
  "Turismo anual": "",
  "VacinaÃ§Ã£o": "",
  "Ãgua potÃ¡vel": "",
  "Ãreas protegidas": "",
  "Ãndice de criminalidade": "",
  "Ãndice de envelhecimento": ""
};
ument.getElementById(x).classList.add("hidden"));document.getElementById(id).classList.remove("hidden")}

// CRIAR PAINEL AUTOMÃTICO
// ===============================
export async function criarPainel(uid, nome) {
  await setDoc(doc(db, "paineis", uid), {
    nome,
    indicadores: INDICADORES_PADRAO,
    criadoEm: serverTimestamp(),
    atualizadoEm: serverTimestamp()
  });
}
/* ================= INIT ================= */
async function init(){
  const snap = await get(ref(db,'contas'));
  let contas = snap.val() || [];
  if(!Array.isArray(contas)) contas = Object.values(contas);

  if(!contas.some(c=>c.login===FUNDADOR_LOGIN)){
    contas.push({login:FUNDADOR_LOGIN,senha:FUNDADOR_SENHA,tipo:"Fundador",saldo:1000000000,bloq:0});
    await set(ref(db,'contas'),contas);
    await set(ref(db,`indicadoresPorConta/${FUNDADOR_LOGIN}`),INDICADORES_PADRAO);
  }
}
init();

/* ================= LOGIN ================= */
async function entrar(){
  const l=luser.value.trim(),p=lpass.value.trim();
  const snap=await get(ref(db,'contas'));
  let contas=snap.val()||[]; if(!Array.isArray(contas)) contas=Object.values(contas);
  const u=contas.find(c=>c.login===l&&c.senha===p);
  if(!u) return msg.innerText="Acesso negado";
  localStorage.setItem("user",u.login);
  carregar();
}

/* ================= PAINEL ================= */
function carregar(){
  const login=localStorage.getItem("user");
  tela("painel");
  onValue(ref(db,'contas'),snap=>{
    let contas=snap.val()||[]; if(!Array.isArray(contas)) contas=Object.values(contas);
    const u=contas.find(c=>c.login===login);
    if(!u) return;
    titulo.innerText=u.tipo+" â€“ "+u.login;
    saldo.innerText="R$ "+formatar(u.saldo);
    bloq.innerText=formatar(u.bloq);
    boxAdmin.classList.toggle("hidden",u.tipo!=="Fundador");
    carregarIndicadores(login);
  });
}

/* ================= INDICADORES ================= */
function carregarIndicadores(login){
  onValue(ref(db,`indicadoresPorConta/${login}`),snap=>{
    const ind=snap.val()||{};
    indicadores.innerHTML="";
    for(const k in ind) indicadores.innerHTML+=`${k}: <span class="dado">${ind[k]}</span><br>`;
  });
}

/* ================= CRIAR CONTA ================= */
btnCriarConta.onclick=async()=>{
  const login=prompt("Login:"),senha=prompt("Senha:");
  if(!login||!senha) return;
  const snap=await get(ref(db,'contas'));
  let contas=snap.val()||[]; if(!Array.isArray(contas)) contas=Object.values(contas);
  if(contas.some(c=>c.login===login)) return alert("Conta existe!");
  contas.push({login,senha,tipo:"Conta",saldo:0,bloq:0});
  await set(ref(db,'contas'),contas);
  await set(ref(db,`indicadoresPorConta/${login}`),INDICADORES_PADRAO);
  alert("Conta criada com indicadores!");
};

/* ================= NB DADOS ================= */
btnNBDados.onclick=()=>{
  const s=prompt("Senha NB DADOS:");
  if(s!==FUNDADOR_SENHA) return alert("Senha invÃ¡lida");
  btnEditIndicadores.classList.remove("hidden");
  btnCriarIndicador.classList.remove("hidden");
};

btnEditIndicadores.onclick=async()=>{
  const login=localStorage.getItem("user");
  const r=ref(db,`indicadoresPorConta/${login}`);
  const snap=await get(r);
  const ind=snap.val()||{};
  for(const k in ind){
    const v=prompt(k,ind[k]);
    if(v!==null) ind[k]=v;
  }
  await set(r,ind);
};

btnCriarIndicador.onclick=async()=>{
  const login=localStorage.getItem("user");
  const nome=prompt("Nome indicador:");
  if(!nome) return;
  const r=ref(db,`indicadoresPorConta/${login}`);
  const snap=await get(r);
  const ind=snap.val()||{};
  ind[nome]="";
  await set(r,ind);
};

/* ================= EVENTOS ================= */
btnAcessar.onclick=()=>tela("login");
btnVoltar.onclick=()=>tela("home");
btnEntrar.onclick=entrar;
btnSair.onclick=()=>{localStorage.clear();tela("home");};
</script>
</body>
</html>
